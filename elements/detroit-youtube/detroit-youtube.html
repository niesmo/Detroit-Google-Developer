<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="/bower_components/google-youtube/google-youtube.html" />
<link rel="import" href="/bower_components/neon-animation/neon-animated-pages.html" />
<link rel="import" href="/bower_components/neon-animation/neon-animatable.html" />
<link rel="import" href="/bower_components/neon-animation/animations/slide-from-right-animation.html" />
<link rel="import" href="/bower_components/neon-animation/animations/slide-left-animation.html" />
<link rel="import" href="/bower_components/paper-header-panel/paper-header-panel.html" />
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html" />
<link rel="import" href="/bower_components/paper-styles/paper-styles.html" />
<link rel="import" href="/bower_components/paper-input/paper-input.html" />
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html" />

<dom-module id="detroit-youtube">
  <template>
    <style is="custom-style">

      paper-toolbar{
        background-color: var(--paper-pink-400);
        color:white;
        font-family: roboto;
        font-weight: 100;
        font-size:18px;
      }
      paper-toolbar div#title{
        margin-right: 20px;
      }
    </style>



    <!-- Search -->
    <paper-header-panel mode="standard">
      <paper-toolbar class="layout flex-horizontal">
        <div id="title">DGD YouTube</div>
        <paper-input no-label-float value={{searchQuery}} autofocus></paper-input>
      </paper-toolbar>

      <div class="fit" on-tap="_tappedPages">
        <neon-animated-pages id="pages" selected="0"
                             entry-animation="slide-from-right-animation"
                             exit-animation="slide-left-animation">
          <neon-animatable>
            <ul>
              <template is="dom-repeat" items="{{searchResult}}">
                <li>{{item.snippet.title}}</li>
              </template>
            </ul>
            <!-- Suggestions for before searching  (MAYBE) -->

            <!-- Search Results -->
          </neon-animatable>
          <neon-animatable> 2 </neon-animatable>
        </neon-animated-pages>
      </div>
    </paper-header-panel>

<!-- How we would have done it, if we were using Spotify -->
<!--     <iron-ajax
        auto
        method="get"
        url="https://api.spotify.com/v1/search"
        params="[[_getSpotifySearchAjaxParams(searchQuery)]]"
        handle-as="json"
        last-response="{{artistsResult}}"
        debounce-duration="250"> </iron-ajax> -->

  </template>

  <script>


    // element registration
    'use strict';
    class DetroitYoutube {
      beforeRegister () {
        this.is = 'detroit-youtube';

        this.properties = {
          searchResult: {
            type:Array,
            value: ()=>{return [];}
          },

          searchQuery: {
            type: String,
            value: "",
            observer: "_searchQueryObserver"
          }
        };
      }

      ready(){}

      attached(){}

      _getSpotifySearchAjaxParams(artistQuery){
        return {
          type: "artist",
          q: artistQuery
        };
      }

      _searchQueryObserver(newQuery, old){
        if(!newQuery) return;
        this.debounce("searchYoutubeDebouncer", this._searchYoutube, 300);
      }


      _searchYoutube(){
        gapi.client.youtube.search.list({
          part: "snippet",
          q: this.searchQuery,
          type: "video",
          order: "relevance",
        })
        .execute(response => {
          this.searchResult = response.items;
        });
      }

      _tappedPages(){
        this.$.pages.selectNext();
      }
    }
    Polymer(DetroitYoutube);

  </script>
